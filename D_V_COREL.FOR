
      SUBROUTINE DVCOREL(I,J,K,IIF,JJF,KKF,DIFFX,DIFFY,DIFFZ,AGWDIFF,
     & AOWDIFF,AWWDIFF,GRIDPOI,ALFADIFF,FT,AOSDIFF,AWSDIFF,AGSDIFF,
     & AOTDIFF,AWTDIFF,AGTDIFF) 
      
      INCLUDE 'PARAMS.FOR'
      
      COMMON /VECTORF/ DXF(LP1F,LP2F,LP3F),DYF(LP1F,LP2F,LP3F),
     & DZF(LP1F,LP2F,LP3F),
     & DZNETF(LP1F,LP2F,LP3F),IQN1F(LP11F),IQN2F(LP11F),IQN3F(LP11F),
     & IHEDINF(80)
     
      COMMON /SSOLNF/ BOF(LP1F,LP2F,LP3F),BWF(LP1F,LP2F,LP3F),
     & BGF(LP1F,LP2F,LP3F),
     & QOF(LP1F,LP2F,LP3F),QWF(LP1F,LP2F,LP3f),QGF(LP1F,LP2F,LP3F),
     & GOWTF(LP1F,LP2F,LP3F),GWWTF(LP1F,LP2F,LP3F),GGWTF(LP1F,LP2F,LP3F)
     & ,O1F(LP4F,LP2F,LP3F),W1F(LP4F,LP2F,LP3F),
     & O2F(LP1F,LP5F,LP3F),W2F(LP1F,LP5F,LP3F),
     & O3F(LP1F,LP2F,LP6F),W3F(LP1F,LP2F,LP6F),
     & G1F(LP4F,LP2F,LP3F),G2F(LP1F,LP5F,LP3F),G3F(LP1F,LP2F,LP6F),
C!   !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
     & QOWGF(LP1F,LP2F,LP3F),CTF(LP1F,LP2F,LP3F)
     
      COMMON /SPRTPSF/ PF(LP1F,LP2F,LP3F)
     
      DIMENSION DIFFX(LP1F,LP2F,LP3F),
     & DIFFY(LP1F,LP2F,LP3F),DIFFZ(LP1F,LP2F,LP3F)
      DIMENSION A1DIFG(LP1F,LP2F,LP3F),A2DIFG(LP1F,LP2F,LP3F)
     &,A3DIFG(LP1F,LP2F,LP3F),A1DIFO(LP1F,LP2F,LP3F),
     & A2DIFO(LP1F,LP2F,LP3F),A3DIFO(LP1F,LP2F,LP3F),
     & A1DIFW(LP1F,LP2F,LP3F),A2DIFW(LP1F,LP2F,LP3F),
     & A3DIFW(LP1F,LP2F,LP3F)
     
     
      DIMENSION TXDIFG(LP4F,LP2F,LP3F),TYDIFG(LP1F,LP5F,LP3F),
     & TZDIFG(LP1F,LP2F,LP6F),TXDIFO(LP4F,LP2F,LP3F),
     & TYDIFO(LP1F,LP5F,LP3F),TZDIFO(LP1F,LP2F,LP6F),
     & TXDIFW(LP4F,LP2F,LP3F),TYDIFW(LP1F,LP5F,LP3F),
     & TZDIFW(LP1F,LP2F,LP6F),CAPOWF(LP1F,LP2F,LP3F),
     & CAPGOF(LP1F,LP2F,LP3F)
     
       REAL(8) DXF,DYF,DZF,DZNETF,IQN1F,IQN2F,IQN3F,IHEDINF,AEFFI,AEFFJ,
     & AEFFK,DIFFX,DIFFY,DIFFZ,BOF,BWF,BGF,QOF,QWF,QGF,GOWTF,GWWTF,GGWTF
     & ,O1F,W1F,O2F,W2F,O3F,W3F,G1F,G2F,G3F,QOWGF,CTF,ALFADIFF,VGRESI,
     & VORESI,VWRESI,DIFFVOI,DIFFVGI,DIFFVWI,TXDIFG,TXDIFO,TXDIFW,A1DIFG
     & ,A1DIFO,A1DIFW,XDENOMFDIFG,XDENOMFDIFO,XDENOMFDIFW,DIFFW1,DIFFO1,
     & DIFFG1,AGWDIFF,AOWDIFF,AWWDIFF,GRIDPOI,PF,DPG1,DPO1,DPW1,PP,PPG,
     & PPW,CAPOWF,CAPGOF,AOSDIFF,AWSDIFF,AGSDIFF,DIFFW2,DIFFO2,DIFFG2,
     & DIFFVOJ,DIFFVGJ,DIFFVWJ,TYDIFG,TYDIFO,YDENOMFDIFG,YDENOMFDIFO,
     & TYDIFW,TZDIFG,TZDIFO,TZDIFW,DPG2,DPO2,DPW2,A2DIFG,A2DIFO,A2DIFW,
     & DIFFW3,DIFFO3,DIFFG3
             
             
                   
             
             
      TXDIFG(I,J,K)=0.0
      TXDIFO(I,J,K)=0.0
      TXDIFW(I,J,K)=0.0
      
      TYDIFG(I,J,K)=0.0
      TYDIFO(I,J,K)=0.0
      TYDIFW(I,J,K)=0.0
      
      TZDIFG(I,J,K)=0.0
      TZDIFO(I,J,K)=0.0
      TZDIFW(I,J,K)=0.0 
      
      DIFFG1=0      
      DIFFW1=0 
      DIFFO1=0 
      
      DIFFG2=0      
      DIFFW2=0 
      DIFFO2=0 
      
      DIFFG3=0      
      DIFFW3=0 
      DIFFO3=0 
      
      AGF = GRIDPOI*0.5  
      AGFB = AGF+0.5
      PP =   PF(I,J,K)
      PPG   = PP + CAPGOF(I,J,K)
      PPW   = PP - CAPOWF(I,J,K)
      
      
      IF(I.LT.2) GO TO 5001
      DPG1= PF(I-1,J,K) + CAPGOF(I-1,J,K) - PPG
      DPO1= PF(I-1,J,K) - PP
      DPW1= PF(I-1,J,K) - CAPOWF(I-1,J,K) - PPW
 
      AEFFI=(DXF(I-1,J,K)*DYF(I-1,J,K)*DZNETF(I-1,J,K)+DXF(I,J,K)*
     & DYF(I,J,K)*DZNETF(I,J,K))/(DXF(I-1,J,K)+DXF(I,J,K))
                
      VGRESI=G1F(I,J,K)*DPG1*(BGF(I-1,J,K)+BGF(I,J,K))*0.5/AEFFI 
      VORESI=O1F(I,J,K)*DPO1*(BOF(I-1,J,K)+BOF(I,J,K))*0.5/AEFFI
      VWRESI=W1F(I,J,K)*DPW1*(BWF(I-1,J,K)+BWF(I,J,K))*0.5/AEFFI
      
      DIFFVGI=DIFFX(I,J,K)+ALFADIFF*(VGRESI+VORESI)
      DIFFVOI=DIFFX(I,J,K)+ALFADIFF*(VORESI+VGRESI)
            

      
      
      A1DIFG(I,J,K) = DIFFVGI*DYF(I,J,K)*
     &DZNETF(I,J,K)
      A1DIFO(I,J,K) = DIFFVOI*DYF(I,J,K)*
     &DZNETF(I,J,K)     

 
      
      XDENOMFDIFG=DXF(I-1,J,K)*A1DIFG(I,J,K)+DXF(I,J,K)
     &*A1DIFG(I-1,J,K)
     
      XDENOMFDIFO=DXF(I-1,J,K)*A1DIFO(I,J,K)+DXF(I,J,K)
     &*A1DIFO(I-1,J,K)
     
      
      IF(XDENOMFDIFG.EQ.0.0) GO TO 5001
      TXDIFG(I,J,K)=.012656*A1DIFG(I-1,J,K)*A1DIFG(I,J,K)/
     & XDENOMFDIFG   
     
      DIFFG1= DIFFVGI/(BGF(I-1,J,K)+BGF(I,J,K))
      
      IF(XDENOMFDIFO.EQ.0.0) GO TO 5001
      TXDIFO(I,J,K)=.012656*A1DIFO(I-1,J,K)*A1DIFO(I,J,K)/
     & XDENOMFDIFO   
      
      DIFFO1= DIFFVOI/(BOF(I-1,J,K)+BOF(I,J,K))
      
    
    
      
      
5001  CONTINUE

      AGWDIFF=TXDIFG(I,J,K)*DIFFG1
      AOWDIFF=TXDIFO(I,J,K)*DIFFO1  
      
      
      
      
      IF(J.LT.2) GO TO 5003
      DPG2= PF(I,J-1,K) + CAPGOF(I,J-1,K) - PPG
      DPO2= PF(I,J-1,K) - PP
      DPW2= PF(I,J-1,K) - CAPOWF(I,J-1,K) - PPW
 
       AEFFJ=(DXF(I,J-1,K)*DYF(I,J-1,K)*DZNETF(I,J-1,K)+DXF(I,J,K)*
     & DYF(I,J,K)*DZNETF(I,J,K))/(DXF(I,J-1,K)+DXF(I,J,K))
                
      VGRESJ=G2F(I,J,K)*DPG2*(BGF(I,J-1,K)+BGF(I,J,K))*0.5/AEFFJ 
      VORESJ=O2F(I,J,K)*DPO2*(BOF(I,J-1,K)+BOF(I,J,K))*0.5/AEFFJ
      VWRESJ=W2F(I,J,K)*DPW2*(BWF(I,J-1,K)+BWF(I,J,K))*0.5/AEFFJ
      
      DIFFVGJ=DIFFY(I,J,K)+ALFADIFF*(VGRESJ+VORESJ)
      DIFFVOJ=DIFFY(I,J,K)+ALFADIFF*(VORESJ+VGRESJ)
            

      
      
      A2DIFG(I,J,K) = DIFFVGJ*DXF(I,J,K)*
     &DZNETF(I,J,K)
      A2DIFO(I,J,K) = DIFFVOJ*DXF(I,J,K)*
     &DZNETF(I,J,K)     

 
      
      YDENOMFDIFG=DYF(I,J-1,K)*A2DIFG(I,J,K)+DYF(I,J,K)
     &*A2DIFG(I,J-1,K)
     
      YDENOMFDIFO=DYF(I,J-1,K)*A2DIFO(I,J,K)+DYF(I,J,K)
     &*A2DIFO(I,J-1,K)
     
      
      IF(YDENOMFDIFG.EQ.0.0) GO TO 5003
      TYDIFG(I,J,K)=.012656*A2DIFG(I,J-1,K)*A2DIFG(I,J,K)/
     & YDENOMFDIFG   
     
      DIFFG2= DIFFVGJ/(BGF(I,J-1,K)+BGF(I,J,K))
      
      IF(YDENOMFDIFO.EQ.0.0) GO TO 5003
      TYDIFO(I,J,K)=.012656*A2DIFO(I,J-1,K)*A2DIFO(I,J,K)/
     & YDENOMFDIFO   
      
      DIFFO2= DIFFVOJ/(BOF(I,J-1,K)+BOF(I,J,K))
      
      
 5003  CONTINUE

      AGSDIFF=TYDIFG(I,J,K)*DIFFG2
      AOSDIFF=TYDIFO(I,J,K)*DIFFO2      
      
c trzeci wymiar       
      
      IF(K.LT.2) GO TO 5005
      DPG3= PF(I,J,K-1) + CAPGOF(I,J,K-1) - PPG
      DPO3= PF(I,J,K-1) - PP
      DPW3= PF(I,J,K-1) - CAPOWF(I,J,K-1) - PPW
 
       AEFFK=(DXF(I,J,K-1)*DYF(I,J,K-1)*DZNETF(I,J,K-1)+DXF(I,J,K)*
     & DYF(I,J,K)*DZNETF(I,J,K))/(DXF(I,J,K-1)+DXF(I,J,K))
                
      VGRESK=G3F(I,J,K)*DPG3*(BGF(I,J,K-1)+BGF(I,J,K))*0.5/AEFFK 
      VORESK=O3F(I,J,K)*DPO3*(BOF(I,J,K-1)+BOF(I,J,K))*0.5/AEFFK
      VWRESK=W3F(I,J,K)*DPW3*(BWF(I,J,K-1)+BWF(I,J,K))*0.5/AEFFK
      
      DIFFVGK=DIFFZ(I,J,K)+ALFADIFF*(VGRESK+VORESK)
      DIFFVOK=DIFFZ(I,J,K)+ALFADIFF*(VORESK+VGRESK)
            

      
      
      A3DIFG(I,J,K) = DIFFVGK*DXF(I,J,K)*
     &DZNETF(I,J,K)
      A3DIFO(I,J,K) = DIFFVOK*DXF(I,J,K)*
     &DZNETF(I,J,K)     

 
      
      ZDENOMFDIFG=DZF(I,J,K-1)*A3DIFG(I,J,K)+DZF(I,J,K)
     &*A3DIFG(I,J,K-1)
     
      ZDENOMFDIFO=DZF(I,J,K-1)*A3DIFO(I,J,K)+DZF(I,J,K)
     &*A3DIFO(I,J,K-1)
     
      
      IF(ZDENOMFDIFG.EQ.0.0) GO TO 5005
      TZDIFG(I,J,K)=.012656*A3DIFG(I,J,K-1)*A3DIFG(I,J,K)/
     & ZDENOMFDIFG   
     
      DIFFG3= DIFFVGK/(BGF(I,J,K-1)+BGF(I,J,K))
      
      IF(ZDENOMFDIFO.EQ.0.0) GO TO 5005
      TZDIFO(I,J,K)=.012656*A3DIFO(I,J,K-1)*A3DIFO(I,J,K)/
     & ZDENOMFDIFO   
      
      DIFFO3= DIFFVOK/(BOF(I,J,K-1)+BOF(I,J,K))
      
      
 5005  CONTINUE

      AGTDIFF=TZDIFG(I,J,K)*DIFFG3
      AOTDIFF=TZDIFO(I,J,K)*DIFFO3            
      
      
      CONTINUE
      
      IF (FT.EQ.5)THEN
      WRITE(103,5002)DIFFVGI,VGRESI+VORESI
      ENDIF
      
      
5002  FORMAT(1X,2F15.6)    
      
      RETURN
      END
